# 주요 설계 고려사항

## 1. 시스템 특성 고려 설계 방향
입출금 시스템의 경우, 정확하게 정보를 제시해야 하므로 **정합성**이 가장 우선되어야 합니다. 각 거래가 이루어지면서 **정합성**을 유지하기 위해 **시간에 따라 데이터 흐름을 기록**하였습니다. 따라서 서버로 수정 작업(CUD)을 요청하였을 때는 순서에 따라 요청 내용을 기록하였습니다. 이를 위해 타 시스템(FE 등)에서 서버로 요청할 때 내용에는 요청 시각을 반드시 포함하도록 설계하였습니다. 그리고 계좌 정보의 경우에도 시간에 따라서 어떻게 변화되는지 기록하였습니다. 이를 위해서는 현재 상태를 나타내는 `ACCOUNT_BASE`와 이력을 나타내는 `ACCOUNT_HIST` 2개의 테이블을 활용했습니다. 이러한 이력 관리를 통해 특정 시점에 시스템에서 오류가 나더라도 기본적으로 재현 가능하도록 하였습니다.

## 2. 무결성 보장에 대하여
위의 `ACCOUNT_BASE`와 `ACCOUNT_HIST`의 형태로 인해 작업이 진행되는 동안 일시적으로 데이터의 정합성이 어긋날 수 있습니다. 이는 작업이 진행되는 동안 상태를 기록하는 방법을 통해 해결하고자 하였습니다. 작업 이력 테이블(`JOB_HIST`) 내에 요청 시에는 `PROC_STAT_CD` 필드를 통해 진행 상태를 기록하고자 하였습니다. 이를 통해 작업이 최종적으로 완료되었을 때만 후속 연산을 진행할 수 있도록 하고자 하였습니다.

추가적으로 `ACCOUNT_BASE`의 현재 잔액(`Balance`)과 `ACCOUNT_HIST`의 거래 후 잔액(`Balance`)에 대해 시스템 설계 에러, 휴먼 에러 등의 사유로 두 개의 데이터가 어긋날 수 있습니다. 예를 들어 계좌 기본 테이블 내 현재 상태의 잔액과 계좌 이력 테이블 내 최신 이력의 거래 후 잔액은 반드시 같아야 합니다. 하지만 이러한 두 개의 데이터를 둠으로써 운용자로 하여금 계좌의 무결성 상태를 확인하는 역할을 합니다. 만약 문제에 주어진 조건 외에 또 다른 연산 작업이 시스템에 추가되는 상황을 가정할 때, 두 개의 데이터가 같지 않을 경우 해당 계좌의 무결성이 위배되었다고 간주하고, 연산 진행을 불가능하도록 막을 수 있습니다.

## 3. DB 설계 시 자료형에 대하여
입출금 시스템에서 자료형은 크게 금액, 날짜(일시), 일반 텍스트로 나눌 수 있습니다.

금액의 경우 먼저 `Double`, `Float` 실수 형태의 경우 연산 시 오차가 발생할 수 있어 제외하였습니다. 그리고 소수점 표기, 앞자리 0 표기 여부에 따라 명확하게 데이터를 인식하고 구분지을 수 있어야 합니다. 이에 소스 코드 레벨에서 연산과정과 DB 자료형을 제외하고는 **문자열**을 활용하고자 하였습니다.

날짜 자료형의 경우, 실제 시스템에서 연산하거나 작업할 때 사용하는 날짜 자료형과 DB에 레코드가 생성되고 수정되는 날짜 정보를 분리하였습니다. 데이터를 가공할 때 필요에 따라서 자료형을 변환해야 합니다. 그런데 `DATE` 자료형에 인덱스가 걸려있을 때 다른 자료형으로 변환하면 DB 인덱스를 사용할 수 없습니다. 또한 비교 연산 시 **문자열**과 `DATE` 자료형을 사용자의 실수로 올바르게 이루어지지 못할 가능성이 있습니다. 따라서 시스템 연산 및 작업에 필요한 날짜 데이터는 **문자열**(`VARCHAR`)을 사용하였습니다. 반면에 DB 레코드 생성/수정 시각을 기록하는 목적의 데이터 자료형은 `TIMESTAMP`를 사용하였습니다.

일반 텍스트의 경우에는 확장 가능성만 고려하였습니다. 시스템을 운용하다가 자료형을 변경하면서 여러 부작용이 발생할 수 있기 때문에 **적요 항목**의 경우 `TEXT` 자료형을 설정하였습니다. 그 외에 자료형은 `VARCHAR` 자료형을 사용했습니다.
